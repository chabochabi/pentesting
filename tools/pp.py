#!/usr/bin/env python

import sys
import argparse

parser = argparse.ArgumentParser(description="/etc/passwd parser")
parser.add_argument('-f', '--file', help='/etc/passwd file', required=True)
parser.add_argument('-u', '--users', action='store_true')
args = parser.parse_args()

passwd_fd = open(args.file, 'r')
lines = passwd_fd.readlines()

# check if file is a one liner... often the result of LFI
if len(lines) == 1:
	print("[*] passwd file is a one-liner")
	sc_ctr = 0
	user_lines = []
	start_idx = 0
	# regex would be fancier, but fuck that
	for i,c in enumerate(lines[0]):
		if c == ":":
			sc_ctr += 1
		if sc_ctr % 6 == 0 and c == " ":
			user_lines.append(lines[0][start_idx:i])
			start_idx = i+1

	print("[*] pretty printing passwd file:\n")
	for line in user_lines:
		print(line)
	print("\n")
else:
	user_lines = lines

human_users = []

# get all human users
for user_entry in user_lines: 
	username = user_entry[:user_entry.find(":")]
	if ("/home/%s" % username) in user_entry:
		print("[*] found a human user: %s " % username)
		human_users.append(username)

print("[*] all human users:\n")
for user in human_users:
	print(user)
